# El patrón Modelo-Vista-Controlador
**Modelo-vista-controlador (MVC)** es un patrón de arquitectura de software, que separa los datos y la lógica de negocio de una aplicación de su representación y el módulo encargado de gestionar los eventos y las comunicaciones. Para ello MVC propone la construcción de tres **componentes** distintos: el **modelo**, la **vista** y el **controlador**:
- El **modelo** es la representación de la información con la que trabaja la aplicación y gestiona todos los accesos a dicha información, tanto consultas como actualizaciones, implementando también los privilegios de acceso que se hayan descrito en las especificaciones de la aplicación (lógica de negocio)
- La **vista** muestra al usuario el modelo (información y lógica de negocio) en un formato adecuado para interactuar (usualmente la interfaz de usuario)
- El **controlador** responde a los eventos del usuario para lo que hace peticiones al modelo (para cambiar la información) y a la vista (para que refleje los cambios realizados).

Este patrón de arquitectura de software se basa en las ideas de reutilización de código y la separación de conceptos, características que buscan facilitar la tarea de desarrollo de aplicaciones y su posterior mantenimiento.

## Nuestro patrón MVC
En una aplicación muy sencilla podemos no seguir este modelo pero en cuanto la misma se complica un poco es imprescindible programar siguiendo buenas prácticas ya que si no nuestro código se volverá rápidamente myu difícil de mantener.

Hay muchas formas de implementar este modelo. Si estamos hciendo un proyecto con POO podemos seguir el patrón MVC usando clases. Crearemos denro de la carpeta _scripts_ 3 subcarpetas:
- _model_: aquí incluiremos las clases que constituyen el modelo de nuestra aplicación
- _view_: aquí crearemos un fichero JS que será el encargado de la UI de nuestra aplicación
- _controller_: aquí crearemos el fichero JS que contendrá el controlador de la aplicación

La vista será una clase sin propiedades (no tendrá un constructor), sólo contendrá métodos para renderizar los distintos elementos de la vista.

El controlador será una clase cuyas propedades serán el modelo y la vista, de forma que pueda acceder a ambos elementos. Tendrá métodos para las distintas acciones que pueda hacer el usuario (que se ejecutarán como respuesta a las acciones del usuario sobre nuestra página, lo veremos en el tema de _eventos_). Cada uno de esos métodos llamará a métodos del modelo (para obtener o cambiar la información necesaria) y posteriormente de la vista (para reflejar esos cambios en lo que ve el usuario).

El fichero principal de la aplicación instanciará un controlador y lo inicializará.

Por ejemplo vamos a hacer una aplicación para gestionar un almacén. El modelo constará de la clase _Store_ que es nuestro almacén de productos (con métodos para añadir o eliminar productos, etc) y la clase _Product_ que gestiona cada producto del almacén (con métodos para crear un nuevo producto, cambiar sus características, etc).

El fichero principal sería algo como:
- main.js
```javascript
const storeApp = new StoreController();		// crea el controlador
storeApp.init();				// lo inicializa

// Podemos añadir algunas líneas que luego quitaremos para imitar acciones del usuario 
// y así ver el funcionamiento de la aplicación:
storeApp.addProductToStore({id: 1, name: 'Portátil Acer Travelmate E2100', price: 523.12});
storeApp.changeProduct({id: 1, price: 515.95});
storeApp.deleteProduct(1);
```

- controller/index.js
```javascript
class StoreController {
  constructor() {
    this.productStore = new Store(1);		// crea el modelo
    this.storeView = new StoreView();		// crea la vista
  }

  init() {
    this.storeView.init();			// inicializa la vista
  }
	
  addProductToStore(prod) {
    const newProd = this.productStore.addProduct(prod);	// dice al modelo que añada el producto
    if (newProd) {
      this.storeView.renderNewProduct(newProd);		// si lo ha hecho le dice a la vista que lo pinte
    } else {
      this.storeView.showErrorMessage('Error al añadir el producto');
    }
  }
  ...
  // También se incluirían los métodos escuchadores para las acciones del usuario sobre la página
}
```

- view/index.js
```javascript
class StoreView{
  init() {
    this.renderTableProducts();
  }

  renderTableProducts() {
    // código para pintar una tabla vacía para los productos del almacén
  }
  
  renderNewProduct(prod) {
    // código para pintar añadir a la tabla el producto pasado
  }
  ...
}
```

- model/store.class.js
```javascript
class Store {
  constructor (id) {
    this.id=Number(id);
    this.products=[];
  }

  addProduct(prod) {
    // comprueba que no esté ya en el almacén y llama ala clase Product para que cree u nuevo producto
    if ( this.findProduct(prod.id) ) return false;
    const newProd = new Product(prod);
    if (newProd) {
      this.products.push(newProd);
      return newProdtrue;
    }
    return false;
  }
  
  findProduct(id) {
    ...
  }
  ...
}
```

- model/product.class.js
```javascript
class Product {
  constructor (prod) {
    this.id = prod.id;
    this.name = prod.name;
    this.proce = prod.price;
  }
  ...
}
```
